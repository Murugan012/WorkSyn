<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkSyn | AI Task Manager</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); width: 100%; max-width: 500px; text-align: center; }
        h1, h2 { color: #2c3e50; }
        input[type="email"], input[type="password"], input[type="text"] { width: calc(100% - 22px); padding: 12px; margin-bottom: 15px; border: 1px solid #dcdcdc; border-radius: 6px; font-size: 16px; }
        button { background-color: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        #auth-buttons button { margin: 5px; }
        #add-task-btn { background-color: #2ecc71; }
        #add-task-btn:hover { background-color: #27ae60; }
        #ai-suggestion-btn { background-color: #9b59b6; margin-top: 20px; }
        #ai-suggestion-btn:hover { background-color: #8e44ad; }
        #task-list { list-style: none; padding: 0; text-align: left; margin-top: 20px; }
        #task-list li { background: #ecf0f1; padding: 15px; border-radius: 6px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        #ai-output { text-align: left; margin-top: 20px; padding: 15px; background: #e8f4fd; border-left: 5px solid #3498db; white-space: pre-wrap; min-height: 50px; max-height: 250px; overflow-y: auto; }
    </style>
</head>
<body>

    <div class="container">
        <div id="auth-container">
            <h2>Welcome to WorkSyn</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <div id="auth-buttons">
                <button id="login-btn">Login</button>
                <button id="signup-btn">Sign Up</button>
            </div>
            <p id="auth-error" style="color: red;"></p>
        </div>

        <div id="app-container" style="display:none;">
            <h1>WorkSyn Tasks</h1>
            <p>Welcome, <span id="user-email"></span>!</p>
            <input type="text" id="task-input" placeholder="e.g., Enter your Daily Task">
            <button id="add-task-btn">Add Task</button>
            <ul id="task-list"></ul>
            <button id="ai-suggestion-btn">âœ¨ Get AI Suggestions</button>
            <div id="ai-output"></div>
            <button id="logout-btn" style="background-color: #7f8c8d; margin-top: 20px;">Logout</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // --- 1. FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyA3lPNLZIRUXaYFnS8b8RPpefO1wA_KFvo",
            authDomain: "worksyn-e308d.firebaseapp.com",
            projectId: "worksyn-e308d",
            storageBucket: "worksyn-e308d.firebasestorage.app",
            messagingSenderId: "729336420824",
            appId: "1:729336420824:web:ffbe1af7fd6b0a59c17aad",
            measurementId: "G-74Q17J2T0R"
        };
        firebase.initializeApp(firebaseConfig);

        // --- 2. GEMINI API KEY ---
        const GEMINI_API_KEY = "AIzaSyA_6GjdOHJX1B6F-hMMbfJY2q7inj6s0lc"; 

        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null;

        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const authError = document.getElementById('auth-error');
        const taskList = document.getElementById('task-list');
        const aiOutput = document.getElementById('ai-output');

        // --- 3. PREDEFINED SUGGESTIONS & MOTIVATION ---
        const fallbackMessages = [
            "ðŸ¤– Server Busy: AI is resting. Use this time to tackle your hardest task!",
            "Motivation: 'The best way to predict the future is to create it.' - Abraham Lincoln",
            "Server Busy: AI is offline, but your progress isn't! Keep going.",
            "Motivation: 'Coding is a superpower. Don't give up on that bug!'",
            "Server Busy: AI is over-caffeinated. Try again in a minute!",
            "Motivation: 'Success is a series of small wins. Cross one more task off!'"
        ];

        // --- 4. AUTH LOGIC ---
        document.getElementById('signup-btn').addEventListener('click', () => {
            auth.createUserWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
                .catch(err => authError.textContent = err.message);
        });

        document.getElementById('login-btn').addEventListener('click', () => {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
                .catch(err => authError.textContent = err.message);
        });

        document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                authContainer.style.display = 'none';
                appContainer.style.display = 'block';
                document.getElementById('user-email').textContent = user.email;
                fetchTasks();
            } else {
                currentUser = null;
                authContainer.style.display = 'block';
                appContainer.style.display = 'none';
            }
        });

        // --- 5. TASK LOGIC ---
        function fetchTasks() {
            db.collection('tasks').doc(currentUser.uid).collection('userTasks').orderBy('createdAt', 'desc')
                .onSnapshot(snap => {
                    taskList.innerHTML = '';
                    snap.forEach(doc => {
                        const li = document.createElement('li');
                        li.innerHTML = `<span>${doc.data().text}</span><button class="delete-btn" onclick="deleteTask('${doc.id}')">Delete</button>`;
                        taskList.appendChild(li);
                    });
                });
        }

        document.getElementById('add-task-btn').addEventListener('click', () => {
            const text = document.getElementById('task-input').value;
            if (text && currentUser) {
                db.collection('tasks').doc(currentUser.uid).collection('userTasks').add({
                    text: text,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('task-input').value = '';
            }
        });

        window.deleteTask = (id) => {
            db.collection('tasks').doc(currentUser.uid).collection('userTasks').doc(id).delete();
        };

        // --- 6. AI LOGIC WITH FALLBACKS ---
        document.getElementById('ai-suggestion-btn').addEventListener('click', async () => {
            aiOutput.textContent = 'ðŸ¤– Thinking...';
            const tasks = Array.from(taskList.querySelectorAll('span')).map(s => s.textContent).join(', ');
            
            if (!tasks) {
                aiOutput.textContent = "Add some tasks first!";
                return;
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Prioritize these tasks: " + tasks }] }] })
                });

                if (!response.ok) throw new Error("API Busy");

                const data = await response.json();
                aiOutput.textContent = data.candidates[0].content.parts[0].text;
            } catch (error) {
                // If the API fails, pick a random message from the fallback list
                const randomMsg = fallbackMessages[Math.floor(Math.random() * fallbackMessages.length)];
                aiOutput.textContent = randomMsg;
                console.error("AI Fetch Error:", error);
            }
        });
    </script>
</body>
</html>
