<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Task Manager</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); width: 100%; max-width: 500px; text-align: center; }
        h1, h2 { color: #2c3e50; }
        input[type="email"], input[type="password"], input[type="text"] { width: calc(100% - 22px); padding: 12px; margin-bottom: 15px; border: 1px solid #dcdcdc; border-radius: 6px; font-size: 16px; }
        button { background-color: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        #auth-buttons button { margin: 5px; }
        #add-task-btn { background-color: #2ecc71; }
        #add-task-btn:hover { background-color: #27ae60; }
        #ai-suggestion-btn { background-color: #9b59b6; margin-top: 20px; }
        #ai-suggestion-btn:hover { background-color: #8e44ad; }
        #task-list { list-style: none; padding: 0; text-align: left; margin-top: 20px; }
        #task-list li { background: #ecf0f1; padding: 15px; border-radius: 6px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        #ai-output {
            text-align: left;
            margin-top: 20px;
            padding: 15px;
            background: #e8f4fd;
            border-left: 5px solid #3498db;
            white-space: pre-wrap;
            min-height: 50px;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="auth-container">
            <h2>Welcome Back!</h2>
            <input type="email" id="email" placeholder="Email" autocomplete="username">
            <input type="password" id="password" placeholder="Password" autocomplete="current-password">
            <div id="auth-buttons">
                <button id="login-btn">Login</button>
                <button id="signup-btn">Sign Up</button>
            </div>
            <p id="auth-error" style="color: red;"></p>
        </div>

        <div id="app-container" style="display:none;">
            <h1>My Tasks</h1>
            <p>Welcome, <span id="user-email"></span>!</p>
            <input type="text" id="task-input" placeholder="e.g., Finish project proposal">
            <button id="add-task-btn">Add Task</button>
            <ul id="task-list"></ul>
            <button id="ai-suggestion-btn">âœ¨ Get AI Suggestions</button>
            <div id="ai-output"></div>
            <button id="logout-btn" style="background-color: #7f8c8d; margin-top: 20px;">Logout</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // --- STEP 1: INITIALIZE FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyCgx3emsEUk6zcRLbL7RFN3yMNInOGxmw0",
            authDomain: "worksyn-b6f78.firebaseapp.com",
            projectId: "worksyn-b6f78",
            storageBucket: "worksyn-b6f78.appspot.com",
            messagingSenderId: "650064392675",
            appId: "1:650064392675:web:79ae410cf07765652770d6",
            measurementId: "G-RZQ7E5HZEP"
        };
        firebase.initializeApp(firebaseConfig);

        // --- STEP 2: AI API CONFIGURATION ---
        const GEMINI_API_KEY = "AIzaSyAkzG7tDmDULx21M6xwKf6lFqWxRYbOcUI";

        // --- FIREBASE SERVICES & DOM REFERENCES ---
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null;
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const authError = document.getElementById('auth-error');

        // --- STEP 3: AUTHENTICATION LOGIC ---
        document.getElementById('signup-btn').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .catch(error => { authError.textContent = error.message; });
        });

        document.getElementById('login-btn').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => { authError.textContent = error.message; });
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            auth.signOut();
        });

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                authContainer.style.display = 'none';
                appContainer.style.display = 'block';
                document.getElementById('user-email').textContent = user.email;
                authError.textContent = '';
                fetchTasks();
            } else {
                currentUser = null;
                authContainer.style.display = 'block';
                appContainer.style.display = 'none';
                document.getElementById('task-list').innerHTML = '';
                document.getElementById('ai-output').innerHTML = '';
            }
        });

        // --- STEP 4: TASK MANAGEMENT (CRUD) ---
        const taskInput = document.getElementById('task-input');
        const taskList = document.getElementById('task-list');

        function fetchTasks() {
            if (!currentUser) return;
            db.collection('tasks').doc(currentUser.uid).collection('userTasks').orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    taskList.innerHTML = '';
                    snapshot.forEach(doc => {
                        const task = doc.data();
                        const li = document.createElement('li');
                        li.innerHTML = `<span>${task.text}</span><button class="delete-btn" data-id="${doc.id}">Delete</button>`;
                        taskList.appendChild(li);
                    });
                });
        }

        document.getElementById('add-task-btn').addEventListener('click', () => {
            const taskText = taskInput.value.trim();
            if (taskText && currentUser) {
                db.collection('tasks').doc(currentUser.uid).collection('userTasks').add({
                    text: taskText,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                taskInput.value = '';
            }
        });

        taskList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-btn') && currentUser) {
                const taskId = e.target.getAttribute('data-id');
                db.collection('tasks').doc(currentUser.uid).collection('userTasks').doc(taskId).delete();
            }
        });

        // --- STEP 5: AI SUGGESTION FEATURE (USING GOOGLE GEMINI) ---
        const aiSuggestionBtn = document.getElementById('ai-suggestion-btn');
        const aiOutput = document.getElementById('ai-output');

        aiSuggestionBtn.addEventListener('click', async () => {
            if (!currentUser) return;
            aiOutput.innerHTML = 'ðŸ¤– Thinking...';

            const taskElements = taskList.querySelectorAll('li span');
            if (taskElements.length === 0) {
                aiOutput.textContent = 'Add some tasks first to get suggestions!';
                return;
            }
            const tasks = Array.from(taskElements).map(el => `- ${el.textContent}`).join('\n');

            const prompt = `
                Based on the following to-do list, please do two things:
                1. Create a prioritized list of these tasks from most to least important.
                2. Provide three actionable productivity tips related to completing these tasks.

                Format your response clearly with headings. My tasks are:
                ${tasks}
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message);
                }
                
                const data = await response.json();
                const suggestion = data.candidates[0].content.parts[0].text;
                
                aiOutput.textContent = suggestion;
            } catch (error) {
                console.error('Error fetching AI suggestion:', error);
                aiOutput.textContent = `Sorry, I couldn't get a suggestion. Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>